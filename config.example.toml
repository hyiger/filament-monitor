# Example configuration for filament-monitor
#
# This file is NOT loaded automatically.
# Use with:  --config /path/to/config.toml
#
# Precedence:
#   CLI arguments > this file > built-in defaults

[serial]
# Serial device for the printer connection
port = "/dev/ttyACM0"
baud = 115200

[gpio]
# BCM GPIO pin numbers
motion_gpio = 26

# Enable/disable runout monitoring
runout_enabled = false
runout_gpio = 27
runout_active_high = false

# Optional physical rearm button (active-low recommended): wire switch between GPIO and GND
# rearm_button_gpio = 25
# rearm_button_debounce = 0.25  # seconds (optional)
# rearm_button_long_press = 1.5  # seconds; short press resets, long press rearms
# rearm_button_active_high = false  # config-only polarity (false=active-low recommended)


# Optional debounce (seconds); omit or set to null to disable
# runout_debounce = 0.05  # seconds (optional)

[detection]
# (Legacy/unused) Jam detection is marker-driven via filmon:arm.
arm_min_pulses = 12

# Seconds without motion (after arming) before declaring a jam
jam_timeout = 8.0

# Optional: adaptive jam timeout (pps-based) to reduce false stalls during sparse extrusion
jam_timeout_adaptive = true
jam_timeout_min = 6.0
jam_timeout_max = 18.0
jam_timeout_k = 16.0
jam_timeout_pps_floor = 0.3
jam_timeout_ema_halflife = 3.0
arm_grace_pulses = 12
arm_grace_s = 12.0

# G-code sent when a jam/runout is detected
pause_gcode = "M600"

[logging]
verbose = false
no_banner = false
json = false
breadcrumb_interval = 2.0
pulse_window = 2.0
# Stall breadcrumbs (debug/tuning): comma-separated seconds (e.g. "3,6")
# or fractions of the effective jam timeout with "x"/"%" suffix (e.g. "0.5x,75%").
stall_thresholds = "0.5x,0.75x"

[control]
# Local UNIX control socket used by filmonctl (useful when the daemon owns the printer serial port).
socket = "/run/filmon/filmon.sock"
